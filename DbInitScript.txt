--USE DATABASE INITIAL SCRIPT BEFORE INSTALLATION. OTHERWISE THE APP WILL THROW AN EXCEPTION
--ALSO, PROVIDE A CONNECTION STRING INTO THE "appconfig.json"

Create table "EVENT_LOG"
(
	"Event_ID" serial NOT NULL,
	"DateTime" Timestamp without time zone NOT NULL,
	"Level" Varchar NOT NULL,
	"Message" Varchar NOT NULL,
	"IsUpdatedByApp" Boolean NOT NULL,
 primary key ("Event_ID")
);

Create table "Employee"
(
	"Employee_ID" uuid default gen_random_uuid() NOT NULL,
	"WorkingStatus" Boolean NOT NULL,
	"TgBotChatId" Bigint UNIQUE,
	"Role" Boolean NOT NULL,
	"Name" Varchar NOT NULL,
	"Login" Varchar NOT NULL UNIQUE,
	"Password" Varchar NOT NULL,
	"Phone" Bigint CHECK ("Phone" BETWEEN 80000000000 AND 89999999999) NOT NULL UNIQUE,
	"E-mail" Varchar,
 primary key ("Employee_ID")
);

Create table "Subject"
(
	"Subject_ID" uuid default gen_random_uuid() NOT NULL,
	"Name" Varchar NOT NULL UNIQUE,
 primary key ("Subject_ID")
);

Create table "StudentGroup"
(
	"StudentGroupCode" Varchar NOT NULL,
	"Specialization" Varchar,
 primary key ("StudentGroupCode")
);

Create table "Tution"
(
	"Subject_ID" uuid references "Subject" ("Subject_ID") 
		ON DELETE CASCADE NOT NULL,
	"Employee_ID" uuid references "Employee" ("Employee_ID") 
		ON DELETE CASCADE NOT NULL,
	"StartDate" Date NOT NULL,
	"EndDate" Date,
 primary key ("Subject_ID", "Employee_ID")
);

Create table "Studying"
(
	"StudentGroupCode" Varchar references "StudentGroup" ("StudentGroupCode") 
		ON UPDATE CASCADE ON DELETE CASCADE NOT NULL,
	"Subject_ID" uuid references "Subject" ("Subject_ID") 
		ON DELETE CASCADE NOT NULL,
	"StartDate" Date,
	"EndDate" Date,
primary key ("Subject_ID", "StudentGroupCode")
);

Create table "Cabinet"
(
	"Number" Varchar NOT NULL,
	"Name" Varchar,
 primary key ("Number")
);

Create table "ClassesTiming_header"
(
	"ClassesTiming_header_ID" uuid default gen_random_uuid() NOT NULL,
	"Name" Varchar NOT NULL UNIQUE,
 primary key ("ClassesTiming_header_ID")
);

Create table "ClassesTiming_body"
(
		"ClassesTiming_header_ID" uuid references "ClassesTiming_header" ("ClassesTiming_header_ID") NOT NULL,
	"ClassNumber" Integer NOT NULL,
	"StartTime" Time NOT NULL,
	"EndTime" Time NOT NULL,
 primary key ("ClassesTiming_header_ID", "ClassNumber")
);

Create table "DailySchedule_header"
(
	"StudentGroupCode" Varchar references "StudentGroup" ("StudentGroupCode") 
		ON UPDATE CASCADE ON DELETE CASCADE NOT NULL,
	"OfDate" Date NOT NULL,
 primary key ("StudentGroupCode","OfDate")
);

Create table "DailySchedule_body"
(
		"StudentGroupCode" Varchar NOT NULL,
		"OfDate" Date NOT NULL,
	"ClassNumber" Integer NOT NULL,
	"ClassesTiming_header_ID" uuid NOT NULL,
	"Employee_ID" uuid references "Employee" ("Employee_ID"),
	"Subject_ID" uuid references "Subject" ("Subject_ID"),
	"CabinetNumber" Varchar references "Cabinet" ("Number")
		ON UPDATE CASCADE,
 primary key ("StudentGroupCode","OfDate","ClassNumber"),
 foreign key ("StudentGroupCode", "OfDate") references "DailySchedule_header" ("StudentGroupCode", "OfDate") 
 	ON UPDATE CASCADE ON DELETE CASCADE,
 foreign key ("ClassNumber", "ClassesTiming_header_ID") references "ClassesTiming_body" ("ClassNumber", "ClassesTiming_header_ID")
);


insert into "Employee" values
(default, true, null, true, 'Козицкий Илья Сергеевич', 'admin', 'admin', 89776736876, 'praktikasuppport@mail.ru'),
(default, true, null, false, 'Мурзина Татьяна Витальевна', 'murzina_login', 'murzina_password', 80000000000, null),
(default, true, null, false, 'Сидорина Владислава Евгеньевна', 'sidorina_login', 'sidorina_password', 81111111111, null),
(default, true, null, false, 'Кириллин Николай Владимирович', 'kirillin_login', 'kirillin_password', 82222222222, null),
(default, true, null, false, 'Шапошникова Кира Александровна', 'shaposhnikova_login', 'shaposhnikova_password', 83333333333, null),
(default, true, null, false, 'Саибназарова Парвина Хусниддиновна', 'saibnazarova_login', 'saibnazarova_password', 84444444444, null),
(default, true, null, false, 'Тебина Ольга Вячеславовна', 'tebina_login', 'tebina_password', 85555555555, null),
(default, true, null, false, 'Федорченко Дмитрий Евгеньевич', 'fedor4enko_login', 'fedor4enko_password', 86666666666, null),
(default, true, null, false, 'Кузнецова Виктория Александровна', 'kuznetsova_login', 'kuznetsova_password', 87777777777, null),
(default, true, null, true, 'Адамейко Алина Сергеевна', 'adameyko_login', 'adameyko_password', 88888888888, null),
(default, true, null, false, 'Истомин Владимир Константинович', 'istomin_login', 'istomin_password', 89999999999, null);


insert into "Subject" values 
(default, 'Химия'),
(default, 'Биология'),
(default, 'ОБЖ'),
(default, 'Физическая культура'),
(default, 'Интернет-маркетинг'),
(default, 'Математика'),
(default, 'Физика'),
(default, 'Русский язык'),
(default, 'Литература'),
(default, 'История'),
(default, 'Обществознание'),
(default, 'Философия'),
(default, 'Информатика'),
(default, 'Введение в специальность'),
(default, 'Индивидуальный проект'),
(default, 'Введение в язык программирования Python'),
(default, 'Основы информационных технологий'),
(default, 'Конфигурирование Windows 10'),
(default, 'География'),
(default, 'История искусства'),
(default, 'Введение в профессию'),
(default, 'Основы графического редактора Adobe Photoshop'),
(default, 'Основы графического редактора Adobe Illustrator'),
(default, 'Дизайн-мышление'),
(default, 'Навигационный и экологический дизайн'),
(default, 'Английский язык');


insert into "Tution" values
((select "Subject_ID" from "Subject" where "Name" = 'Химия'), 
(select "Employee_ID" from "Employee" where "Login" = 'murzina_login'),
'2020-01-01', null),
((select "Subject_ID" from "Subject" where "Name" = 'Биология'), 
(select "Employee_ID" from "Employee" where "Login" = 'murzina_login'),
'2020-01-01', null),
((select "Subject_ID" from "Subject" where "Name" = 'ОБЖ'), 
(select "Employee_ID" from "Employee" where "Login" = 'murzina_login'),
'2020-01-01', null),
((select "Subject_ID" from "Subject" where "Name" = 'Физическая культура'), 
(select "Employee_ID" from "Employee" where "Login" = 'sidorina_login'),
'2020-01-01', null),
((select "Subject_ID" from "Subject" where "Name" = 'Интернет-маркетинг'), 
(select "Employee_ID" from "Employee" where "Login" = 'kirillin_login'),
'2020-01-01', null),
((select "Subject_ID" from "Subject" where "Name" = 'Математика'), 
(select "Employee_ID" from "Employee" where "Login" = 'shaposhnikova_login'),
'2020-01-01', null),
((select "Subject_ID" from "Subject" where "Name" = 'Физика'), 
(select "Employee_ID" from "Employee" where "Login" = 'shaposhnikova_login'),
'2020-01-01', null),
((select "Subject_ID" from "Subject" where "Name" = 'Русский язык'), 
(select "Employee_ID" from "Employee" where "Login" = 'saibnazarova_login'),
'2020-01-01', null),
((select "Subject_ID" from "Subject" where "Name" = 'Литература'), 
(select "Employee_ID" from "Employee" where "Login" = 'saibnazarova_login'),
'2020-01-01', null),
((select "Subject_ID" from "Subject" where "Name" = 'История'), 
(select "Employee_ID" from "Employee" where "Login" = 'tebina_login'),
'2020-01-01', null),
((select "Subject_ID" from "Subject" where "Name" = 'Обществознание'), 
(select "Employee_ID" from "Employee" where "Login" = 'tebina_login'),
'2020-01-01', null),
((select "Subject_ID" from "Subject" where "Name" = 'Философия'), 
(select "Employee_ID" from "Employee" where "Login" = 'tebina_login'),
'2020-01-01', null),
((select "Subject_ID" from "Subject" where "Name" = 'Информатика'), 
(select "Employee_ID" from "Employee" where "Login" = 'fedor4enko_login'),
'2020-01-01', null),
((select "Subject_ID" from "Subject" where "Name" = 'Введение в специальность'), 
(select "Employee_ID" from "Employee" where "Login" = 'fedor4enko_login'),
'2020-01-01', null),
((select "Subject_ID" from "Subject" where "Name" = 'Индивидуальный проект'), 
(select "Employee_ID" from "Employee" where "Login" = 'fedor4enko_login'),
'2020-01-01', null),
((select "Subject_ID" from "Subject" where "Name" = 'Введение в язык программирования Python'), 
(select "Employee_ID" from "Employee" where "Login" = 'fedor4enko_login'),
'2020-01-01', null),
((select "Subject_ID" from "Subject" where "Name" = 'Основы информационных технологий'), 
(select "Employee_ID" from "Employee" where "Login" = 'fedor4enko_login'),
'2020-01-01', null),
((select "Subject_ID" from "Subject" where "Name" = 'Конфигурирование Windows 10'), 
(select "Employee_ID" from "Employee" where "Login" = 'fedor4enko_login'),
'2020-01-01', null),
((select "Subject_ID" from "Subject" where "Name" = 'География'), 
(select "Employee_ID" from "Employee" where "Login" = 'kuznetsova_login'),
'2020-01-01', null),
((select "Subject_ID" from "Subject" where "Name" = 'История искусства'), 
(select "Employee_ID" from "Employee" where "Login" = 'adameyko_login'),
'2020-01-01', null),
((select "Subject_ID" from "Subject" where "Name" = 'Индивидуальный проект'), 
(select "Employee_ID" from "Employee" where "Login" = 'adameyko_login'),
'2020-01-01', null),
((select "Subject_ID" from "Subject" where "Name" = 'Введение в профессию'), 
(select "Employee_ID" from "Employee" where "Login" = 'adameyko_login'),
'2020-01-01', null),
((select "Subject_ID" from "Subject" where "Name" = 'Основы графического редактора Adobe Photoshop'), 
(select "Employee_ID" from "Employee" where "Login" = 'adameyko_login'),
'2020-01-01', null),
((select "Subject_ID" from "Subject" where "Name" = 'Основы графического редактора Adobe Illustrator'), 
(select "Employee_ID" from "Employee" where "Login" = 'adameyko_login'),
'2020-01-01', null),
((select "Subject_ID" from "Subject" where "Name" = 'Дизайн-мышление'), 
(select "Employee_ID" from "Employee" where "Login" = 'adameyko_login'),
'2020-01-01', null),
((select "Subject_ID" from "Subject" where "Name" = 'Навигационный и экологический дизайн'), 
(select "Employee_ID" from "Employee" where "Login" = 'adameyko_login'),
'2020-01-01', null),
((select "Subject_ID" from "Subject" where "Name" = 'Английский язык'), 
(select "Employee_ID" from "Employee" where "Login" = 'istomin_login'),
'2020-01-01', null);


insert into "StudentGroup" values
('9/1-ГД-23/2', 'Графический дизайн'),
('9/1-РПО-23/1', 'Информационные системы и программирование');


insert into "Studying" values
('9/1-ГД-23/2', (select "Subject_ID" from "Subject" where "Name" = 'Дизайн-мышление')),
('9/1-РПО-23/1', (select "Subject_ID" from "Subject" where "Name" = 'Информатика'));


insert into "Cabinet" values
(702, 'Purple'),
(703, 'Blue'),
(705, 'Orange'),
(708, 'Red');


insert into "ClassesTiming_header" values
(default, 'Основное'),
(default, 'Сокращённое');
insert into "ClassesTiming_body" values
((select "ClassesTiming_header_ID" from "ClassesTiming_header" where "Name" = 'Основное'), 
1, '9:00', '10:30'),
((select "ClassesTiming_header_ID" from "ClassesTiming_header" where "Name" = 'Основное'), 
2, '10:40', '12:10'),
((select "ClassesTiming_header_ID" from "ClassesTiming_header" where "Name" = 'Основное'), 
3, '13:00', '14:30'),
((select "ClassesTiming_header_ID" from "ClassesTiming_header" where "Name" = 'Основное'), 
4, '14:40', '16:10'),
((select "ClassesTiming_header_ID" from "ClassesTiming_header" where "Name" = 'Сокращённое'), 
1, '9:00', '10:00'),
((select "ClassesTiming_header_ID" from "ClassesTiming_header" where "Name" = 'Сокращённое'), 
2, '10:10', '11:10'),
((select "ClassesTiming_header_ID" from "ClassesTiming_header" where "Name" = 'Сокращённое'), 
3, '11:20', '12:20'),
((select "ClassesTiming_header_ID" from "ClassesTiming_header" where "Name" = 'Сокращённое'), 
4, '12:30', '13:30');